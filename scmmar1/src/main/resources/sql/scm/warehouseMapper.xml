<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.happyjob.study.scm.warehouse.dao.WarehouseDao">


	<select id="getWarehouseList" parameterType="kr.happyjob.study.scm.warehouse.model.PageInfo" resultType="kr.happyjob.study.scm.warehouse.model.Warehouse">
		SELECT
				tw.wh_id,
				tw.wh_nm,
				loginID,
				(SELECT email FROM tb_userinfo tu WHERE tw.loginID=tu.loginID) AS email,
				(SELECT phone FROM tb_userinfo tu WHERE tw.loginID=tu.loginID) AS phone,
				tw.zipCode,
				tw.wh_loc
		FROM
			tb_warehouse tw
		<where>
			<if test='!"all".equals(searchType)'>
				
					<if test='"wh_nm".equals(searchType)'>
						AND wh_nm
					</if>
					<if test='"wh_loc".equals(searchType)'>
						AND wh_loc
					</if>
						LIKE CONCAT('%',#{keyword},'%')
				
			</if>
			<if test='"all".equals(searchType)'>
				AND (
						wh_nm LIKE CONCAT('%',#{keyword},'%')
						OR
						wh_loc LIKE CONCAT('%',#{keyword},'%')
					)
			
			</if>
		</where>
		ORDER BY
			wh_id
		LIMIT #{firstIndex}, #{rowsPerPage}
	</select>
	
	
	<select id="getTotalCount" parameterType="kr.happyjob.study.scm.warehouse.model.PageInfo" resultType="Integer">
			 
		SELECT
			COUNT(1)
		FROM
			tb_warehouse tw
		<where>
			<if test='!"all.equals(searchType)"'>
				
					<if test='"wh_nm".equals(searchType)'>
						AND wh_nm
					</if>
					<if test='"wh_loc".equals(searchType)'>
						AND wh_loc
					</if>
						LIKE CONCAT('%',#{keyword},'%')
				
			</if>
			<if test='"all".equals(searchType)'>
					AND (
							wh_nm LIKE CONCAT('%',#{keyword},'%')
							OR
							wh_loc LIKE CONCAT('%',#{keyword},'%')
						)
				
			</if>
		</where>
	</select>
	
	
	<select id="getWareHouseInfo" resultType="kr.happyjob.study.scm.warehouse.model.WarehouseDetail">
		SELECT
				tw.wh_id,
				tu.loginID,
				tw.wh_nm,
				tu.name,
				tu.email,
				tu.phone,
				tw.zipCode,
				tw.wh_loc,
				tw.addr,
				tw.dtAddress
				
		FROM
			tb_warehouse tw JOIN tb_userinfo tu
		ON
			tw.loginID=tu.loginID
		WHERE
			wh_id=#{arg0}
	</select>
		
	
	



</mapper>