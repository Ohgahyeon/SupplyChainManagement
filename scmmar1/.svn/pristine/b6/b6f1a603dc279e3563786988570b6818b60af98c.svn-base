package kr.happyjob.study.scm.sales.service;

import java.util.List;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import kr.happyjob.study.scm.sales.dao.SalesManageDao;
import kr.happyjob.study.scm.sales.model.PageInfo;
import kr.happyjob.study.scm.sales.model.Sales;
import kr.happyjob.study.scm.sales.model.SalesDetails;

@Service
public class SalesManageServiceImpl implements SalesManageService{
	
	
	private SqlSessionTemplate sst;
	
	public SalesManageServiceImpl() {
	
	}
	
	@Autowired
	public SalesManageServiceImpl(SqlSessionTemplate sst) {
		
		this.sst = sst;
	}

	@Override
	@Transactional
	public PageInfo getSalesList(PageInfo info) {
		
		info.setTotalCount(sst.getMapper(SalesManageDao.class).getTotalCount(info));
		
		int selectPage=info.getSelectPage();
		int rowsPerPage=info.getRowsPerPage();
		int total=info.getTotalCount();
		
		int totalPage=total/rowsPerPage;
		totalPage=total%rowsPerPage>0? totalPage+1 : totalPage;
		
		selectPage=selectPage>totalPage? totalPage : selectPage;
		
		info.setSelectPage(selectPage);
		
		
		
		info.setFirstIndex(info.getRowsPerPage()*(info.getSelectPage()-1));
		
		info.setSalesList(sst.getMapper(SalesManageDao.class).getSalesList(info));
		
		
		
		return info;
	}
	
	
	@Override
	public SalesDetails getSalesDetails(String sales_id){
		// 상품상세정보 가져오기
		SalesDetails info = sst.getMapper(SalesManageDao.class).getSalesDetails(sales_id);
		
		
		// 상품에 대한 첨부파일들 DB 정보 가져오기
		// SalesDetails 안의 fileList에 저장
		//...
		//..
		//.
		//...
		////////////////////////////
		
		return info;
		
	}
	
	@Override
	public int deleteSales(String idx) {
		
		return 0;
	}

	@Override
	public int updateSales(String idx) {
		
		return 0;
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

}
