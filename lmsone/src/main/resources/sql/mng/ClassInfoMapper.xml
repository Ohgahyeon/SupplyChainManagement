<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.mng.dao.ClassInfoDao">

	<select id="selectClassListCnt" parameterType="hashMap" resultType="_int">
		  SELECT COUNT(*) 
		    FROM tb_classinfo CI
      INNER JOIN tb_userinfo UI
              ON CI.loginID = UI.loginID 
 LEFT OUTER JOIN   
                (
                 SELECT COUNT(CI.class_no) class_cnt,CI.class_no
                   FROM tb_classinfo CI
             INNER JOIN tb_courselist CL
                     ON CI.class_no = CL.class_no
               GROUP BY CI.class_no
                 ) CNT
              ON CI.class_no = CNT.class_no
           WHERE <![CDATA[  CI.class_startdate > #{searchStartDate} ]]>            
             AND <![CDATA[  CI.class_enddate < #{searchEndDate} ]]>             
             AND 
             <if test='searchKind == "class_Nm"'>
             	CI.class_nm LIKE #{keyword}
             </if>
             <if test='searchKind=="name"'>
             	UI.name LIKE #{keyword}
             </if>   
	</select>

	<select id="selectClassList" parameterType="hashMap" resultType="ClassTInfoDto">
	      SELECT CI.class_type, CI.class_nm, UI.name, CI.class_startdate, CI.class_enddate,CNT.class_cnt, CI.class_totalcnt, CI.class_no
            FROM tb_classinfo CI
      INNER JOIN tb_userinfo UI
              ON CI.loginID = UI.loginID 
 LEFT OUTER JOIN   
                (
                 SELECT COUNT(CI.class_no) class_cnt,CI.class_no
                   FROM tb_classinfo CI
             INNER JOIN tb_courselist CL
                     ON CI.class_no = CL.class_no
               GROUP BY CI.class_no
                 ) CNT
              ON CI.class_no = CNT.class_no
           WHERE <![CDATA[  CI.class_startdate > #{searchStartDate} ]]>            
             AND <![CDATA[  CI.class_enddate < #{searchEndDate} ]]>             
             AND 
             <if test='searchKind == "class_Nm"'>
             	CI.class_nm LIKE #{keyword}
             </if>
             <if test='searchKind=="name"'>
             	UI.name LIKE #{keyword}
             </if>             
	</select>

	<select id="selectUserList" resultType="ClassListUserInfoDto">
		SELECT UI.loginID, UI.name, UI.gender, UI.birth, UI.email, UI.join_yn, UI.reg_date  
	      FROM tb_userinfo UI
	INNER JOIN tb_courselist CL
	        ON UI.loginID = CL.loginID
	     WHERE CL.class_no = #{class_No}
	</select>
	
	<select id="selectUserListCnt" resultType="_int">
		SELECT COUNT(*)  
	      FROM tb_userinfo UI
	INNER JOIN tb_courselist CL
	        ON UI.loginID = CL.loginID
	     WHERE CL.class_no = #{class_No}
	</select>
	
</mapper>


