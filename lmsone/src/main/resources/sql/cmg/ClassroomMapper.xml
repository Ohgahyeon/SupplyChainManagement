<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.cmg.dao.ClassroomDao">

	<!-- 강의실 목록 조회 -->
	<select id="listClassroom" resultType="kr.happyjob.study.cmg.model.ClassroomModel">
		/*kr.happy.study.cmg.dao.ClassroomDao.listClassroom*/
		SELECT		
				room_no as roomNo
			,	room_nm as roomNm
			, 	room_area as roomArea
			,	room_size as roomSize
			,	room_etc as roomEtc
		FROM	tb_classroom
		<!--여기 이해안가요...  -->
		<where>
		<!--검색한 것이 있다면인가???  -->
	<if test="(sname != null) and (!sname.equals(''))">
		<choose>
			<when test="oname eq 'classroom_no'.toString()">
				and room_no = #{sname}
			</when>
			<when test="oname eq 'classroom_nm'.toString()">
				and room_nm LIKE CONCAT('%', #{sname}, '%')
			</when>
			<otherwise>

			</otherwise>
		</choose>
	</if>
</where>
		
		LIMIT #{pageIndex}, #{pageSize}
		
		
	</select>
	
	<!-- 강의실 목록 총 갯수 조회 -->
	<select id="countListClassroom" resultType="int">
		/*kr.happy.study.cmg.dao.ClassroomDao.countListClassroom*/
		SELECT COUNT(1) AS tot_cnt FROM tb_classroom
		<where>
			<if test="(sname != null) and (!sname.equals(''))">
				<choose>
					<when
						test="oname eq 'classroom_no'.toString()">
						and room_no = #{sname}
					</when>
					<when
						test="oname eq 'classroom_nm'.toString()">
						and room_nm LIKE CONCAT('%', #{sname}, '%')
					</when>
					
					<otherwise>
		
					</otherwise>
				</choose>
			</if>
		</where>
		
	</select>
	
	
	<!-- 강의실 단건 조회 -->
 	<select id="selectRoomOne" resultType="kr.happyjob.study.cmg.model.ClassroomModel">
		/*kr.happy.study.cmg.dao.ClassroomDao.selectRoomOne*/
		SELECT  cr.room_no as roomNo
			,	cr.room_nm as roomNm
			, 	cr.room_area as roomArea
			,	cr.room_size as roomSize
			,	cr.room_etc as roomEtc
			,  ( 
	               select sum(ll.cnt) 
	                 from (
	                        select count(ci.class_no) cnt from tb_classinfo ci where ci.room_no = #{roomno} 
	                        union
	                        select count(cq.equi_no) cnt from tb_classequi cq where cq.room_no = #{roomno}
	                      ) ll  
               ) as classnum
		from tb_classroom cr
		where cr.room_no = #{roomno}
	</select> 
	
	<!-- 강의실 저장 -->
	<insert id="insertClassRoom">
		/*kr.happyjob.study.cmg.dao.ClassroomDao.insertClassRoom*/
		INSERT INTO tb_classroom
		(
				room_nm
			, 	room_area
			,	room_size
			,	room_etc
		)
		VALUES
		(
				#{rName}
			,	#{rSize}
			,   #{rSit}
			,	#{rContent}
		)		
	</insert>
	
	
	<!-- 강의실 수정- -->
	<update id="updateClassRoom">
		/*kr.happy.study.cmg.dao.ClassroomDao.updateClassRoom*/
		UPDATE tb_classroom  SET
				room_nm = #{rName}
			,	room_area = #{rSize}
			,   room_size = #{rSit}
			,	room_etc = #{rContent}
		WHERE	room_no = #{roomno}
	</update>
	
	
	<!-- 강의실 삭제 -->
	<delete id="deleteClassRoom">
		/*kr.happy.study.cmg.dao.ClassroomDao.deleteClassRoom*/
		DELETE FROM tb_classroom WHERE room_no = #{roomno}
	</delete>
	
	
	<!--장비목록 조회  -->
	<select id="listEquipment" resultType="kr.happyjob.study.cmg.model.EquipmentModel">
		/*kr.happy.study.cmg.dao.ClassroomDao.listEquipment*/
		SELECT	@rownum:=@rownum+1 as row_num	
			,	tt.room_no as room_No
			,	ta.equi_no as equi_No
			, 	ta.equi_nm as equi_Nm
			,	ta.equi_cnt as equi_Cnt
			,	ta.equi_etc as equi_Etc		
		FROM	tb_classequi ta
			, 	tb_classroom tt
			WHERE	(@rownum:=0)=0
			AND ta.room_no = tt.room_no
			AND ta.room_no = #{r_no}
		ORDER BY ta.equi_no ASC
		<if test="(pageIndex != null) and (!pageIndex.equals('')) and (pageSize != null) and (!pageSize.equals(''))">
		LIMIT #{pageIndex}, #{pageSize}
		</if>
	</select>
	
	<!-- 장비목록 총 갯수 조회 -->
	<select id="countListEquipment" resultType="int">
		/*kr.happy.study.cmg.dao.ClassoDao.countListEquipment*/
		SELECT COUNT(1) AS tot_cnt FROM tb_classequi WHERE room_No = #{r_no} 
	</select>	
	
		<!-- 장비 단건 조회 -->
	<select id="selectCmgEqui" resultType="kr.happyjob.study.cmg.model.EquipmentModel">
		/*kr.happy.study.cmg.dao.ClassroomDao.selectCmgEqui*/
		SELECT
				equi_no,
				room_no,
				equi_nm,
				equi_cnt,
				equi_etc
		FROM	tb_classequi
		WHERE   room_no = #{r_no} and equi_no = #{e_no}
	</select>
	
	<!-- 장비 저장 -->
	<insert id="insertEquipment">
		/*kr.happyjob.study.cmg.dao.ClassroomDao.insertEquipment*/
		INSERT INTO tb_classequi
		(
				equi_no
			, 	room_no
			,	equi_nm
			,	equi_cnt
			,	equi_etc
		)
		VALUES
		(
				#{e_no}
			,	#{r_no}
			,   #{e_name}
			,   #{e_cnt}
			,	#{e_etc}
		)		
	</insert>
	
		<!-- 장비 수정 -->
	<update id="updateEquipment">
	/*updateEquipment*/
		UPDATE tb_classequi
		SET    equi_nm = #{e_name},
			   equi_cnt = #{e_cnt},
			   equi_etc = #{e_etc}
		WHERE  room_no = #{r_no}
		AND    equi_no = #{e_no}
	</update>
	
	<!-- 장비 삭제 -->
	<delete id="deleteEquipment">
	/*deleteEquipment*/
	DELETE FROM tb_classequi WHERE room_no = #{r_no} AND equi_no = #{e_no}
	</delete>
	
</mapper>