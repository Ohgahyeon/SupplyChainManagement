<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.jmg.dao.CareerInfoDao">

	<!-- 취업정보 목록 총건 : 페이징 처리 하려고 가져왔다 -->
	<select id="totalCount" resultType="int" parameterType="map">
		/*kr.happy.study.jmg.dao.CareerInfoDao.totalCount*/
			SELECT	COUNT(*) 
			  FROM	tb_career a 
				INNER JOIN tb_userinfo b ON a.loginID = b.loginID
			 WHERE	DATE_FORMAT(a.join_date, '%Y-%m-%d') =  
		     (
		        SELECT MAX(DATE_FORMAT(join_date, '%Y-%m-%d')) 
		          FROM tb_career 
		         WHERE loginID = a.loginID
		      )
		<if test="(sname != null) and (!sname.equals(''))">
			<choose>
				<when test="oname eq 'career_corp'.toString()">
					AND a.corp LIKE CONCAT('%', #{sname}, '%')
				</when>
				<when test="oname eq 'career_name'.toString()">
					AND b.name LIKE CONCAT('%', #{sname}, '%')
				</when>
				<otherwise>
					AND 1=2
				</otherwise>
			</choose>
		</if>
		<if test="(cal1 != null) and (!cal1.equals(''))">
			AND DATE_FORMAT(a.join_date, '%Y-%m-%d') <![CDATA[>=]]> #{cal1}			
		</if>
		<if test="(cal2 != null) and (!cal2.equals(''))">
			AND DATE_FORMAT(a.join_date, '%Y-%m-%d') <![CDATA[<=]]> #{cal2}			
		</if>
	</select>
	
	<!-- 취업정보 목록조회  -->
	<select id="listCareerInfo" resultType="map" parameterType="map">
		/*kr.happy.study.jmg.dao.CareerInfoDao.listCareerInfo*/
		SELECT	b.name AS name
			 ,	DATE_FORMAT(a.join_date, '%Y-%m-%d') AS join_date
			 ,	IF(a.resign_date IS NULL, '-', a.resign_date) AS resign_date
			 ,	a.corp AS corp
			 ,	b.join_yn AS join_yn
			 ,	a.loginID AS loginID
		  FROM	tb_career a 
			INNER JOIN tb_userinfo b ON a.loginID = b.loginID
		 WHERE	DATE_FORMAT(a.join_date, '%Y-%m-%d') =  
		     (
		        SELECT MAX(DATE_FORMAT(join_date, '%Y-%m-%d'))
		          FROM tb_career 
		         WHERE loginID = a.loginID
		      )
		<if test="(sname != null) and (!sname.equals(''))">
			<choose>
				<when test="oname eq 'career_corp'.toString()">
					AND a.corp LIKE CONCAT('%', #{sname}, '%')
				</when>
				<when test="oname eq 'career_name'.toString()">
					AND b.name LIKE CONCAT('%', #{sname}, '%')
				</when>
				<otherwise>
					AND 1=2
				</otherwise>
			</choose>
		</if>
		<if test="(cal1 != null) and (!cal1.equals(''))">
			AND DATE_FORMAT(a.join_date, '%Y-%m-%d') <![CDATA[>=]]> #{cal1}			
		</if>
		<if test="(cal2 != null) and (!cal2.equals(''))">
			AND DATE_FORMAT(a.join_date, '%Y-%m-%d') <![CDATA[<=]]> #{cal2}			
		</if>
		ORDER BY DATE_FORMAT(a.join_date, '%Y-%m-%d') DESC
		LIMIT #{pageIndex}, #{pageSize}
	</select>
	
	<!-- 개인 취업정보 이력 조회  -->
	<select id="careerDetail" resultType="map" parameterType="map">
		/*kr.happy.study.jmg.dao.CareerInfoDao.careerDetail*/
        SELECT	b.name AS name
			 ,	a.join_date AS join_date
			 ,	IF(a.resign_date IS NULL, '현재', a.resign_date) AS resign_date
			 ,	a.corp AS corp
		  FROM	tb_career a 
			INNER JOIN tb_userinfo b ON a.loginID = b.loginID
		 WHERE	a.loginID = #{uid}
	  ORDER BY	a.join_date DESC
	</select>
	
	
</mapper>